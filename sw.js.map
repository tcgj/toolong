{"version":3,"file":"sw.js","mappings":"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","sources":["webpack://toolong/./src/util.ts","webpack://toolong/./src/commands/commands.ts","webpack://toolong/./src/commands/dictionary.ts","webpack://toolong/./src/commands/duckduckgo.ts","webpack://toolong/./src/commands/github.ts","webpack://toolong/./src/commands/google.ts","webpack://toolong/./src/commands/stackoverflow.ts","webpack://toolong/./src/commands/youtube.ts","webpack://toolong/./src/index.ts"],"sourcesContent":["export namespace Utils {\n  export function tokenize(value: string, delimiter: string = ' '): string[] {\n    return value.split(delimiter).filter((s) => s);\n  }\n\n  export function tokensToSearchString(tokens: string[], delimiter: string = ' '): string {\n    return encodeURIComponent(tokens.join(delimiter));\n  }\n\n  export function makeSearchUrl(endpoint: string, searchParams: Record<string, string>): string {\n    const queryPairs = Object.entries(searchParams);\n    if (!queryPairs.length) {\n      return endpoint;\n    }\n    return `${endpoint}${`?${queryPairs.map(([key, value]) => `${key}=${value}`).join('&')}`}`;\n  }\n\n  export function makeSimpleSearchUrl(endpoint: string, searchKey: string, tokens: string[]): string {\n    return makeSearchUrl(endpoint, { [searchKey]: tokensToSearchString(tokens) });\n  }\n\n  export function makeRedirectResponse(url: string): Response {\n    return Response.redirect(url, 302);\n  }\n}\n","import { CommandHandler } from './command-handler';\n\nexport class Commands implements CommandHandler {\n  private commandMap = new Map<string, CommandHandler>();\n\n  constructor(private fallbackHandler?: CommandHandler) {}\n\n  async search(tokens: string[]): Promise<Response> {\n    const handler = this.get(tokens[0]);\n\n    if (!handler) {\n      if (this.fallbackHandler) {\n        return this.fallbackHandler.search(tokens);\n      } else {\n        throw new Error(\"No handler found for this command. Please contact TooLong's developer for support.\");\n      }\n    }\n\n    return handler.search(tokens.slice(1)).catch((error) => {\n      if (this.fallbackHandler) {\n        return this.fallbackHandler.search(tokens);\n      }\n      throw error;\n    });\n  }\n\n  get(commandString: string): CommandHandler | undefined {\n    return this.commandMap.get(commandString);\n  }\n\n  add(commandString: string, handler: CommandHandler): Commands {\n    this.commandMap.set(commandString, handler);\n    return this;\n  }\n\n  setFallback(handler: CommandHandler): Commands {\n    this.fallbackHandler = handler;\n    return this;\n  }\n}\n","import { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\nimport { Commands } from './commands';\n\nexport const DICTIONARY_COMMAND_NAME = 'dict';\n\nconst dictionaryComCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchString = Utils.tokensToSearchString(tokens, '-');\n    const searchUrl = `https://www.dictionary.com/browse/${searchString}`;\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n\nconst baiduCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl('https://dict.baidu.com/s', 'wd', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n\nconst jishoCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchString = Utils.tokensToSearchString(tokens);\n    const searchUrl = `https://jisho.org/search/${searchString}`;\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n\nexport const dictionaryCommandHandler = new Commands()\n  .add('en', dictionaryComCommandHandler)\n  .add('chn', baiduCommandHandler)\n  .add('jp', jishoCommandHandler);\n","import { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\n\nexport const DUCK_DUCK_GO_COMMAND_NAME = 'd';\n\nexport const duckDuckGoCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl('https://www.duckduckgo.com', 'q', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n","import { Commands } from './commands';\nimport { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\n\nexport const GITHUB_COMMAND_NAME = 'gh';\n\nconst GITHUB_BASE_URL = 'https://github.com/search';\nconst GITHUB_API_BASE_URL = 'https://api.github.com/search';\n\nconst defaultSearchHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl(GITHUB_BASE_URL, 'q', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n\nasync function makeGithubSearchHandler(resource: string, tokens: string[]): Promise<Response> {\n  if (tokens.length === 0) {\n    const searchUrl = Utils.makeSearchUrl(GITHUB_BASE_URL, { type: resource });\n    return Utils.makeRedirectResponse(searchUrl);\n  }\n\n  const searchUrl = Utils.makeSimpleSearchUrl(`${GITHUB_API_BASE_URL}/${resource}`, 'q', tokens);\n  const response = await fetch(searchUrl);\n  if (!response.ok) {\n    const body = await response.text();\n    return new Response(`[${response.status}${response.statusText ?? ` ${response.statusText}`}] GitHub API: ${body}`, {\n      status: 500,\n    });\n  }\n\n  const { items } = await response.json();\n  if (items.length === 0) {\n    return new Response(`No ${resource} found from GitHub for ${tokens.join(' ')}.`, { status: 404 });\n  }\n\n  return Utils.makeRedirectResponse(items[0].html_url);\n}\n\nexport const githubCommandHandler = new Commands(defaultSearchHandler)\n  .add('r', { search: (tokens) => makeGithubSearchHandler('repositories', tokens) })\n  .add('u', { search: (tokens) => makeGithubSearchHandler('users', tokens) });\n","import { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\n\nexport const GOOGLE_COMMAND_NAME = 'gg';\n\nexport const googleCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl('https://www.google.com/search', 'q', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n","import { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\n\nexport const STACK_OVERFLOW_COMMAND_NAME = 'so';\n\nexport const stackOverflowCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl('https://stackoverflow.com/search', 'q', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n","import { Utils } from '../util';\nimport { CommandHandler } from './command-handler';\n\nexport const YOUTUBE_COMMAND_NAME = 'yt';\n\nexport const youtubeCommandHandler: CommandHandler = {\n  search: async (tokens) => {\n    const searchUrl = Utils.makeSimpleSearchUrl('https://www.youtube.com/results', 'search_query', tokens);\n    return Utils.makeRedirectResponse(searchUrl);\n  },\n};\n","declare const self: ServiceWorkerGlobalScope;\nexport type {};\n\nimport { Commands } from './commands/commands';\nimport { dictionaryCommandHandler, DICTIONARY_COMMAND_NAME } from './commands/dictionary';\nimport { duckDuckGoCommandHandler, DUCK_DUCK_GO_COMMAND_NAME } from './commands/duckduckgo';\nimport { githubCommandHandler, GITHUB_COMMAND_NAME } from './commands/github';\nimport { googleCommandHandler, GOOGLE_COMMAND_NAME } from './commands/google';\nimport { stackOverflowCommandHandler, STACK_OVERFLOW_COMMAND_NAME } from './commands/stackoverflow';\nimport { youtubeCommandHandler, YOUTUBE_COMMAND_NAME } from './commands/youtube';\nimport { Utils } from './util';\n\nconst COMMANDS = new Commands(duckDuckGoCommandHandler)\n  .add(DUCK_DUCK_GO_COMMAND_NAME, duckDuckGoCommandHandler)\n  .add(GOOGLE_COMMAND_NAME, googleCommandHandler)\n  .add(GITHUB_COMMAND_NAME, githubCommandHandler)\n  .add(YOUTUBE_COMMAND_NAME, youtubeCommandHandler)\n  .add(STACK_OVERFLOW_COMMAND_NAME, stackOverflowCommandHandler)\n  .add(DICTIONARY_COMMAND_NAME, dictionaryCommandHandler);\n\nasync function getSearchResponse(searchString: string): Promise<Response> {\n  const tokens = Utils.tokenize(searchString);\n\n  return COMMANDS.search(tokens).catch((err: Error) => new Response(err.message));\n}\n\nfunction setFallbackSearchHandler(altSearch: string) {\n  switch (altSearch) {\n    case 'google':\n      COMMANDS.setFallback(googleCommandHandler);\n      break;\n    case 'duckduckgo':\n      COMMANDS.setFallback(duckDuckGoCommandHandler);\n      break;\n    default:\n      break;\n  }\n}\n\nself.addEventListener('install', () => {\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    self.clients\n      .claim()\n      .then(() => {\n        // See https://developer.mozilla.org/en-US/docs/Web/API/Clients/matchAll\n        return self.clients.matchAll({ type: 'window' });\n      })\n      .then((clients) => {\n        return clients.map((client) => {\n          // Check to make sure WindowClient.navigate() is supported.\n          if ('navigate' in client) {\n            return client.navigate(client.url); // Immediately reload to perform search\n          }\n        });\n      })\n  );\n});\n\nself.addEventListener('fetch', (event) => {\n  // Fix bug when opening link in new tab\n  // https://stackoverflow.com/a/49719964\n  if (event.request.cache === 'only-if-cached' && event.request.mode !== 'same-origin') {\n    return;\n  }\n\n  const url = new URL(event.request.url);\n  const searchString = url.searchParams.get('search');\n  if (searchString == null) {\n    return;\n  }\n\n  const fallback = url.searchParams.get('fallback');\n  if (fallback) {\n    setFallbackSearchHandler(fallback);\n  }\n\n  event.respondWith(getSearchResponse(searchString));\n});\n"],"names":["Utils","fallbackHandler","commandMap","Map","search","tokens","handler","this","get","Error","slice","catch","error","commandString","add","set","setFallback","tokensToSearchString","delimiter","encodeURIComponent","join","makeSearchUrl","endpoint","searchParams","queryPairs","Object","entries","length","map","key","value","tokenize","split","filter","s","makeSimpleSearchUrl","searchKey","makeRedirectResponse","url","Response","redirect","dictionaryComCommandHandler","searchString","searchUrl","baiduCommandHandler","jishoCommandHandler","dictionaryCommandHandler","Commands","duckDuckGoCommandHandler","GITHUB_BASE_URL","makeGithubSearchHandler","resource","type","fetch","response","ok","text","body","status","statusText","json","items","html_url","githubCommandHandler","googleCommandHandler","stackOverflowCommandHandler","youtubeCommandHandler","COMMANDS","self","addEventListener","skipWaiting","event","waitUntil","clients","claim","then","matchAll","client","navigate","request","cache","mode","URL","fallback","altSearch","setFallbackSearchHandler","respondWith","err","message","getSearchResponse"],"sourceRoot":""}